{% extends "base.html" %}

{% block title %}Skills & Learning{% endblock %}

{% block content %}
<h1 class="section-header">Skills & Learning</h1>

<div class="card" style="margin-top: 30px;">
    <h2>Skills Radar</h2>
    <div style="max-width: 600px; margin: 30px auto;">
        <canvas id="skillRadar"></canvas>
    </div>
</div>

<div class="card" style="margin-top: 30px;">
    <h2>Skill Levels</h2>
    <div style="margin-top: 20px;">
        {% for skill in data.skills %}
        <div style="margin-bottom: 25px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <strong>{{ skill.name }}</strong>
                <span>{{ skill.level }}% / {{ skill.target }}%</span>
            </div>
            <div class="skill-bar" onclick="updateSkill('{{ skill.name }}', {{ skill.level }})">
                <div class="skill-fill" style="width: {{ skill.level }}%;"></div>
                <div style="position: absolute; left: {{ skill.target }}%; top: 0; bottom: 0; width: 2px; background: #dc3545;"></div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="card" style="margin-top: 30px;">
    <h2>Learning Log</h2>
    <form id="learningLogForm" style="margin-top: 20px;">
        <div class="form-group">
            <label for="entry">Learning Entry</label>
            <textarea id="entry" name="entry" class="form-textarea" rows="4" required placeholder="What did you learn today?"></textarea>
        </div>

        <div class="form-group">
            <label for="tags">Tags (comma-separated)</label>
            <input type="text" id="tags" name="tags" class="form-input" placeholder="python, machine-learning, aws">
        </div>

        <button type="submit" class="btn btn-primary">Add Entry</button>
    </form>
</div>

<div style="margin-top: 40px;">
    <h2 class="section-header">Learning Entries</h2>
    <div style="display: grid; gap: 20px; margin-top: 20px;">
        {% for entry in data.learning_log[::-1] %}
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                <div style="color: #6c757d; font-size: 0.9em;">{{ entry.date }}</div>
                <div>
                    {% for tag in entry.tags %}
                    <span class="badge" style="margin-left: 5px;">{{ tag }}</span>
                    {% endfor %}
                </div>
            </div>
            <p style="white-space: pre-wrap;">{{ entry.entry }}</p>
        </div>
        {% endfor %}
    </div>
</div>

<script>
function updateSkill(skillName, currentLevel) {
    const newLevel = prompt(`Update level for ${skillName} (current: ${currentLevel}%):`, currentLevel);
    if (newLevel !== null) {
        fetch('/api/skill', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                name: skillName,
                level: parseInt(newLevel)
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        });
    }
}

document.getElementById('learningLogForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const tags = document.getElementById('tags').value
        .split(',')
        .map(tag => tag.trim())
        .filter(tag => tag.length > 0);

    const formData = {
        entry: document.getElementById('entry').value,
        tags: tags,
        date: new Date().toISOString().split('T')[0]
    };

    fetch('/api/learning_log', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    })
    .catch(error => console.error('Error:', error));
});
</script>

<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
<script>const skillsData = {{ data.skills | tojson }};</script>
{% endblock %}
