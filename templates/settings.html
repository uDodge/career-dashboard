{% extends "base.html" %}

{% block title %}Settings - Career Dashboard{% endblock %}

{% block content %}
<div class="container">
    <h1 class="section-header">Settings</h1>

    <!-- Settings Form -->
    <div class="card" style="margin-bottom: 30px;">
        <h2 class="section-header">Dashboard Configuration</h2>

        <form id="settingsForm" onsubmit="saveSettings(event)">
            <div class="form-group">
                <label for="weekly_study_target">Weekly Study Target Hours</label>
                <input
                    type="number"
                    id="weekly_study_target"
                    name="weekly_study_target_hours"
                    class="form-input"
                    min="1"
                    max="168"
                    value="{{ data.settings.weekly_study_target_hours }}"
                    required>
            </div>

            <div class="form-group">
                <label for="agent_zero_url">Aria WebSocket URL</label>
                <input
                    type="text"
                    id="agent_zero_url"
                    name="agent_zero_url"
                    class="form-input"
                    value="{{ data.settings.agent_zero_url }}"
                    placeholder="ws://192.168.1.95:50001">
            </div>

            <div class="form-group">
                <label for="theme">Theme</label>
                <select id="theme" name="theme" class="form-select">
                    <option value="dark" {% if data.settings.theme == 'dark' %}selected{% endif %}>Dark</option>
                    <option value="light" {% if data.settings.theme == 'light' %}selected{% endif %}>Light</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Save Settings</button>
        </form>
    </div>

    <!-- System Information -->
    <div class="card" style="margin-bottom: 30px;">
        <h2 class="section-header">System Information</h2>

        <div class="stats-row" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
            <div class="stat-card">
                <div class="stat-label">Platform</div>
                <div class="stat-value">Raspberry Pi 5</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Operating System</div>
                <div class="stat-value">Raspberry Pi OS</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Dashboard Version</div>
                <div class="stat-value">1.0.0</div>
            </div>
        </div>
    </div>

    <!-- Aria Status -->
    <div class="card">
        <h2 class="section-header">Aria Status</h2>

        <div id="agentStatus" style="padding: 20px;">
            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                <div id="statusIndicator" class="badge badge-pending" style="margin-right: 10px;">Checking...</div>
                <span id="statusText" style="color: #ccc;">Connecting to Aria...</span>
            </div>

            <div style="color: #888; font-size: 14px;">
                <strong>Container:</strong> agent-zero<br>
                <strong>URL:</strong> <span id="agentUrl">{{ data.settings.agent_zero_url }}</span><br>
                <strong>Data Directory:</strong> /home/udodge/agent-zero-data/
            </div>
        </div>

        <button onclick="checkAgentStatus()" class="btn btn-small" style="margin-top: 15px;">
            Refresh Status
        </button>
    </div>

    <!-- Info Section -->
    <div class="card" style="margin-top: 30px;">
        <h2 class="section-header">About</h2>
        <p style="color: #ccc; line-height: 1.6;">
            This Career Dashboard tracks PJ's transition from IT to AI Solutions Architect.
            It integrates with Aria for enhanced AI-powered career planning and resource management.
        </p>

        <div style="margin-top: 20px; padding: 15px; background-color: #1a1a1a; border-radius: 5px;">
            <h3 style="color: #fff; margin-bottom: 10px;">Key Features</h3>
            <ul style="color: #ccc; line-height: 1.8;">
                <li>Three-phase career roadmap tracking</li>
                <li>Portfolio project management</li>
                <li>Resource library with filtering</li>
                <li>Time tracking and confidence journaling</li>
                <li>Certification roadmap planning</li>
                <li>Monthly self-assessment reviews</li>
            </ul>
        </div>
    </div>
</div>

<script>
async function saveSettings(event) {
    event.preventDefault();

    const formData = {
        weekly_study_target_hours: parseInt(document.getElementById('weekly_study_target').value),
        agent_zero_url: document.getElementById('agent_zero_url').value,
        theme: document.getElementById('theme').value
    };

    try {
        const response = await fetch('/api/settings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        if (response.ok) {
            alert('Settings saved successfully!');

            // Apply theme if changed
            if (formData.theme === 'light') {
                document.body.classList.add('light-theme');
            } else {
                document.body.classList.remove('light-theme');
            }
        } else {
            alert('Failed to save settings');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error saving settings');
    }
}

async function checkAgentStatus() {
    const statusIndicator = document.getElementById('statusIndicator');
    const statusText = document.getElementById('statusText');

    statusIndicator.className = 'badge badge-pending';
    statusIndicator.textContent = 'Checking...';
    statusText.textContent = 'Connecting to Aria...';

    try {
        // This would be replaced with actual WebSocket or API check
        const response = await fetch('/api/agent_status');

        if (response.ok) {
            const data = await response.json();

            if (data.status === 'online') {
                statusIndicator.className = 'badge badge-complete';
                statusIndicator.textContent = 'Online';
                statusText.textContent = 'Aria is running and accessible';
            } else {
                statusIndicator.className = 'badge badge-pending';
                statusIndicator.textContent = 'Offline';
                statusText.textContent = 'Aria is not responding';
            }
        } else {
            statusIndicator.className = 'badge badge-pending';
            statusIndicator.textContent = 'Unknown';
            statusText.textContent = 'Unable to check status';
        }
    } catch (error) {
        console.error('Error:', error);
        statusIndicator.className = 'badge badge-pending';
        statusIndicator.textContent = 'Error';
        statusText.textContent = 'Failed to connect to Aria';
    }
}

// Check status on page load
window.addEventListener('load', checkAgentStatus);
</script>

<style>
.stats-row {
    display: grid;
    gap: 20px;
    margin-top: 20px;
}

.stat-card {
    background-color: #1a1a1a;
    padding: 20px;
    border-radius: 5px;
}

.stat-label {
    color: #888;
    font-size: 14px;
    margin-bottom: 8px;
}

.stat-value {
    color: #fff;
    font-size: 18px;
    font-weight: 600;
}
</style>
{% endblock %}
